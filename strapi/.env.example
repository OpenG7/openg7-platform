# Strapi v5 — configuration de développement
# Dupliquez ce fichier en `.env` puis ajustez les secrets avant de lancer `yarn strapi develop`.

# Serveur HTTP
HOST=0.0.0.0
PORT=1337
APP_KEYS=dev-key-a,dev-key-b
SESSION_KEYS=session-key-a,session-key-b
ADMIN_ENCRYPTION_KEY=change-me-admin-encryption-key

# Sessions & rate limit
STRAPI_SESSION_DRIVER=redis
STRAPI_SESSION_KEY=openg7.sid
STRAPI_SESSION_TTL=86400000
STRAPI_SESSION_COOKIE_SECURE=false
STRAPI_SESSION_COOKIE_SAMESITE=lax
STRAPI_SESSION_COOKIE_DOMAIN=
STRAPI_SESSION_COOKIE_MAXAGE=
STRAPI_SESSION_REDIS_PREFIX=strapi:sess:
RATE_LIMIT_ENABLED=true
RATE_LIMIT_INTERVAL_MS=60000
RATE_LIMIT_MAX=250
RATE_LIMIT_PREFIX=strapi::rl::
ACTIVATION_EMAIL_COOLDOWN_ENABLED=true
ACTIVATION_EMAIL_COOLDOWN_MS=120000
ACTIVATION_EMAIL_COOLDOWN_PREFIX=strapi::activation-email-cooldown::
# Utilise Redis quand STRAPI_SESSION_DRIVER=redis (sinon fallback mémoire)
ACTIVATION_EMAIL_COOLDOWN_USE_REDIS=true

# Redis (sessions, rate limit, throttling)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_USERNAME=
REDIS_PASSWORD=
REDIS_TLS=false

# CORS — origines autorisées pour les appels front (SSR/preview inclus)
CORS_ALLOWED_ORIGINS=http://localhost:4200,http://localhost:4000
CORS_ALLOW_CREDENTIALS=true

# Base de données — Postgres managé obligatoire en multi-pods
DATABASE_CLIENT=postgres
DATABASE_HOST=postgres
DATABASE_PORT=5432
DATABASE_NAME=openg7_cms
DATABASE_SCHEMA=public
DATABASE_USERNAME=openg7
DATABASE_PASSWORD=change-me
DATABASE_SSL=false
DATABASE_SSL_REJECT_UNAUTHORIZED=true
DATABASE_SSL_CA=
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=20

# Bootstrap admin & jetons API (seeds)
STRAPI_ADMIN_EMAIL=contact@openg7.org
STRAPI_ADMIN_PASSWORD=change-me
STRAPI_ADMIN_FIRSTNAME=Admin
STRAPI_ADMIN_LASTNAME=User
STRAPI_SEED_ADMIN_ALLOWED=true
# Si omis, la seed admin est active uniquement en development/dev/integration/test.
STRAPI_API_READONLY_TOKEN=og7_frontend_readonly_token
# Définissez STRAPI_SEED_AUTO=false dans tous les environnements multi-pods
STRAPI_SEED_AUTO=true

# Prévisualisation du front (endpoint /api/homepage/preview)
PREVIEW_TOKEN=preview-token

# Email transactionnel (HostPapa SMTP)
# HostPapa supporte typiquement mail.papamail.net:465 (SSL) ou 587 (STARTTLS).
# Si votre domaine publie son propre endpoint, utilisez par exemple mail.openg7.org.
SMTP_HOST=mail.papamail.net
SMTP_PORT=465
SMTP_SECURE=true
SMTP_REQUIRE_TLS=false
SMTP_USERNAME=notify@openg7.org
# Quotez la valeur si le mot de passe contient `#`, `;`, des espaces ou des caractères spéciaux.
# Exemple: SMTP_PASSWORD="abc#123"
SMTP_PASSWORD=change-me
SMTP_DEFAULT_FROM_NAME=OpenG7
SMTP_DEFAULT_FROM=notify@openg7.org
SMTP_DEFAULT_REPLY_TO=notify@openg7.org
SMTP_CONNECTION_TIMEOUT_MS=10000
SMTP_GREETING_TIMEOUT_MS=10000
SMTP_SOCKET_TIMEOUT_MS=20000

# Notification webhooks (alertes utilisateur) - protection SSRF
# Laissez WEBHOOK_ALLOWED_HOSTS vide pour autoriser toute cible publique.
# En production, preferez une allowlist stricte (ex: hooks.slack.com,api.make.com).
WEBHOOK_REQUIRE_HTTPS=true
WEBHOOK_ALLOW_PRIVATE_NETWORKS=false
WEBHOOK_ALLOW_LOCALHOST=false
WEBHOOK_ALLOWED_HOSTS=
WEBHOOK_TIMEOUT_MS=5000

# Médias — stockage objet (S3/Backblaze)
UPLOAD_PROVIDER=aws-s3
UPLOAD_S3_BUCKET=og7-strapi
UPLOAD_S3_REGION=ca-central-1
UPLOAD_S3_ENDPOINT=https://s3.ca-central-1.amazonaws.com
UPLOAD_S3_BASE_URL=
UPLOAD_S3_PREFIX=
UPLOAD_S3_ACL=private
UPLOAD_S3_FORCE_PATH_STYLE=false
UPLOAD_S3_ACCESS_KEY_ID=change-me
UPLOAD_S3_SECRET_ACCESS_KEY=change-me

# Intégration moteur de recherche (Meilisearch par défaut)
SEARCH_ENGINE_DRIVER=meilisearch
SEARCH_ENGINE_URL=http://localhost:7700
SEARCH_ENGINE_API_KEY=masterKey
SEARCH_ENGINE_AUTH_HEADER=X-Meili-API-Key
SEARCH_ENGINE_AUTH_SCHEME=
SEARCH_ENGINE_INDEX_COMPANIES=companies
SEARCH_ENGINE_INDEX_EXCHANGES=exchanges
