<div class="indicator-alert-drawer" *ngIf="open()" data-og7="indicator-alert-drawer">
  <button class="indicator-alert-drawer__backdrop" type="button" (click)="onBackdropClick()" aria-hidden="true"></button>

  <section class="indicator-alert-drawer__panel" role="dialog" [attr.aria-modal]="true">
    <header>
      <h2>{{ 'feed.indicator.detail.actions.createAlert' | translate }}</h2>
      <small *ngIf="indicatorTitle()">{{ indicatorTitle() }}</small>
      <button type="button" [attr.aria-label]="'feed.drawer.close' | translate" (click)="closed.emit()">x</button>
    </header>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <label>
        <span>{{ 'feed.indicator.detail.drawer.thresholdDirection' | translate }}</span>
        <select
          formControlName="thresholdDirection"
          data-og7="indicator-alert-field"
          data-og7-id="threshold-direction"
        >
          <option value="gt">{{ 'feed.indicator.detail.drawer.direction.gt' | translate }}</option>
          <option value="lt">{{ 'feed.indicator.detail.drawer.direction.lt' | translate }}</option>
        </select>
      </label>

      <label>
        <span>{{ 'feed.indicator.detail.drawer.thresholdValue' | translate }}</span>
        <div class="indicator-alert-drawer__field-row">
          <input
            type="number"
            min="0"
            max="500"
            formControlName="thresholdValue"
            data-og7="indicator-alert-field"
            data-og7-id="threshold-value"
          />
          <small>%</small>
        </div>
      </label>

      <div class="indicator-alert-drawer__grid">
        <label>
          <span>{{ 'feed.indicator.detail.drawer.window' | translate }}</span>
          <select formControlName="window" data-og7="indicator-alert-field" data-og7-id="window">
            <option value="1h">{{ 'feed.indicator.detail.drawer.window1h' | translate }}</option>
            <option value="24h">{{ 'feed.indicator.detail.drawer.window24h' | translate }}</option>
          </select>
        </label>

        <label>
          <span>{{ 'feed.indicator.detail.drawer.frequency' | translate }}</span>
          <select formControlName="frequency" data-og7="indicator-alert-field" data-og7-id="frequency">
            <option value="instant">{{ 'feed.indicator.detail.drawer.frequencyInstant' | translate }}</option>
            <option value="hourly">{{ 'feed.indicator.detail.drawer.frequencyHourly' | translate }}</option>
            <option value="daily">{{ 'feed.indicator.detail.drawer.frequencyDaily' | translate }}</option>
          </select>
        </label>
      </div>

      <label class="indicator-alert-drawer__toggle">
        <input
          type="checkbox"
          formControlName="notifyDelta"
          data-og7="indicator-alert-field"
          data-og7-id="notify-delta"
        />
        <span>{{ 'feed.indicator.detail.drawer.notifyDelta' | translate }}</span>
      </label>

      <label>
        <span>{{ 'feed.indicator.detail.drawer.note' | translate }}</span>
        <textarea rows="4" formControlName="note" data-og7="indicator-alert-field" data-og7-id="note"></textarea>
      </label>

      <p
        class="indicator-alert-drawer__status indicator-alert-drawer__status--success"
        *ngIf="submitState() === 'success'"
        data-og7="indicator-alert-status"
        data-og7-id="success"
      >
        {{ 'feed.indicator.detail.drawer.status.success' | translate }}
      </p>
      <p
        class="indicator-alert-drawer__status indicator-alert-drawer__status--offline"
        *ngIf="submitState() === 'offline'"
        data-og7="indicator-alert-status"
        data-og7-id="offline"
      >
        {{ 'feed.indicator.detail.drawer.status.offline' | translate }}
      </p>
      <p
        class="indicator-alert-drawer__status indicator-alert-drawer__status--error"
        *ngIf="submitState() === 'error'"
        data-og7="indicator-alert-status"
        data-og7-id="error"
      >
        {{ submitError() || ('feed.indicator.detail.drawer.status.errorGeneric' | translate) }}
      </p>

      <div class="indicator-alert-drawer__actions">
        <button
          *ngIf="showRetry()"
          type="button"
          class="indicator-alert-drawer__retry"
          [disabled]="submitting()"
          (click)="retryRequested.emit()"
          data-og7="action"
          data-og7-id="indicator-alert-retry"
        >
          {{ 'feed.indicator.detail.drawer.retry' | translate }}
        </button>
        <button type="submit" [disabled]="submitting()" data-og7="action" data-og7-id="indicator-alert-submit">
          {{ submitting() ? ('feed.indicator.detail.drawer.submitting' | translate) : ('feed.indicator.detail.drawer.submit' | translate) }}
        </button>
      </div>
    </form>
  </section>
</div>
