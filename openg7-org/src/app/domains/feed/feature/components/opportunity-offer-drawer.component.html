<div class="opportunity-offer-drawer" *ngIf="visible()" data-og7="opportunity-offer-drawer">
  <button class="opportunity-offer-drawer__backdrop" type="button" (click)="onBackdropClick()" aria-hidden="true"></button>

  <section class="opportunity-offer-drawer__panel" role="dialog" [attr.aria-modal]="true">
    <header>
      <h2>{{ 'feed.opportunity.detail.cta.makeOffer' | translate }}</h2>
      <button type="button" (click)="closed.emit()" [attr.aria-label]="'feed.drawer.close' | translate">x</button>
    </header>

    <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
      <label>
        <span>{{ 'feed.opportunity.detail.offer.capacity' | translate }}</span>
        <div class="opportunity-offer-drawer__field-row">
          <input
            type="number"
            min="1"
            formControlName="capacityMw"
            data-og7="opportunity-offer-field"
            data-og7-id="capacity"
          />
          <small>MW</small>
        </div>
      </label>

      <div class="opportunity-offer-drawer__grid">
        <label>
          <span>{{ 'feed.opportunity.detail.offer.start' | translate }}</span>
          <input
            type="date"
            formControlName="startDate"
            data-og7="opportunity-offer-field"
            data-og7-id="start-date"
          />
        </label>
        <label>
          <span>{{ 'feed.opportunity.detail.offer.end' | translate }}</span>
          <input
            type="date"
            formControlName="endDate"
            data-og7="opportunity-offer-field"
            data-og7-id="end-date"
          />
        </label>
      </div>

      <label>
        <span>{{ 'feed.opportunity.detail.offer.pricing' | translate }}</span>
        <select formControlName="pricingModel" data-og7="opportunity-offer-field" data-og7-id="pricing-model">
          <option value="spot">{{ 'feed.opportunity.detail.pricing.spot' | translate }}</option>
          <option value="indexed">{{ 'feed.opportunity.detail.pricing.indexed' | translate }}</option>
          <option value="fixed">{{ 'feed.opportunity.detail.pricing.fixed' | translate }}</option>
        </select>
      </label>

      <label>
        <span>{{ 'feed.opportunity.detail.offer.comment' | translate }}</span>
        <textarea formControlName="comment" rows="4" data-og7="opportunity-offer-field" data-og7-id="comment"></textarea>
      </label>

      <label>
        <span>{{ 'feed.opportunity.detail.offer.attachment' | translate }}</span>
        <input
          type="file"
          (change)="onAttachmentSelected($event)"
          data-og7="opportunity-offer-field"
          data-og7-id="attachment"
        />
      </label>

      <p class="opportunity-offer-drawer__attachment" *ngIf="form.controls.attachmentName.value">
        {{ form.controls.attachmentName.value }}
      </p>

      <p
        class="opportunity-offer-drawer__status opportunity-offer-drawer__status--success"
        *ngIf="submitState() === 'success'"
        data-og7="opportunity-offer-status"
        data-og7-id="success"
      >
        {{ 'feed.opportunity.detail.offer.status.success' | translate }}
      </p>
      <p
        class="opportunity-offer-drawer__status opportunity-offer-drawer__status--offline"
        *ngIf="submitState() === 'offline'"
        data-og7="opportunity-offer-status"
        data-og7-id="offline"
      >
        {{ 'feed.opportunity.detail.offer.status.offline' | translate }}
      </p>
      <p
        class="opportunity-offer-drawer__status opportunity-offer-drawer__status--error"
        *ngIf="submitState() === 'error'"
        data-og7="opportunity-offer-status"
        data-og7-id="error"
      >
        {{ submitError() || ('feed.opportunity.detail.offer.status.errorGeneric' | translate) }}
      </p>

      <div class="opportunity-offer-drawer__actions">
        <button
          *ngIf="showRetry()"
          class="opportunity-offer-drawer__retry"
          type="button"
          (click)="retryRequested.emit()"
          [disabled]="submitting()"
          data-og7="action"
          data-og7-id="opportunity-offer-retry"
        >
          {{ 'feed.opportunity.detail.offer.retry' | translate }}
        </button>

        <button type="submit" [disabled]="submitting()" data-og7="action" data-og7-id="opportunity-offer-submit">
          {{ submitting() ? ('feed.opportunity.detail.offer.sending' | translate) : ('feed.opportunity.detail.offer.send' | translate) }}
        </button>
      </div>
    </form>
  </section>
</div>
