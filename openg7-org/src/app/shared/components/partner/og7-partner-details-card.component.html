<article
  class="relative flex h-full flex-col gap-6 overflow-hidden rounded-4xl bg-white/95 p-8 text-slate-900 shadow-[0_30px_80px_-40px_rgba(15,23,42,0.7)] ring-1 ring-slate-200/70"
>
  @if (profile(); as entity) {
    <header class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <div class="flex items-center gap-4">
        @if (entity.logoUrl) {
          <img
            [src]="entity.logoUrl"
            class="h-16 w-16 rounded-2xl bg-slate-100 object-cover shadow-inner ring-1 ring-slate-200"
            [alt]="entity.legalName"
            loading="lazy"
          />
        } @else {
          <div class="flex h-16 w-16 items-center justify-center rounded-2xl bg-slate-200 text-lg font-semibold text-slate-500">
            {{ initials(entity.legalName) }}
          </div>
        }

        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">
            {{ roleLabel(entity.role) | translate }}
          </p>
          <h3 class="text-2xl font-semibold text-slate-900">{{ entity.legalName }}</h3>
          @if (entity.displayName) {
            <p class="text-sm text-slate-500">{{ entity.displayName }}</p>
          }
        </div>
      </div>

      <div class="flex flex-col items-end gap-2 text-xs font-semibold uppercase tracking-[0.25em]">
        <span class="inline-flex items-center gap-2 rounded-full border border-emerald-400/60 bg-emerald-50 px-3 py-1 text-emerald-700">
          <span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span>
          {{ 'introBillboard.scoreBadge' | translate:{ value: confidencePercent() } }}
        </span>
        <span
          class="inline-flex items-center rounded-full px-3 py-1 text-[0.65rem]"
          [ngClass]="verificationStatusClass(verificationStatus())"
        >
          {{ verificationStatusKey() | translate }}
        </span>
        @if (trustScore(); as reliabilityScore) {
          <span class="text-[0.65rem] font-semibold uppercase tracking-[0.25em] text-slate-500">
            {{ 'partner.panel.verification.trustScore' | translate:{ value: reliabilityScore } }}
          </span>
        }
      </div>
    </header>

    <section class="grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]">
      <div class="space-y-4">
        <dl class="space-y-3 text-sm text-slate-700">
          @if (entity.registrationIds?.length) {
            <div class="rounded-2xl bg-slate-100/80 p-4 ring-1 ring-slate-200">
              <dt class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{{ 'partner.card.identifiers' | translate }}</dt>
              <dd class="mt-2 flex flex-wrap gap-2">
                @for (identifier of entity.registrationIds; track identifier.value) {
                  <span class="rounded-full bg-slate-900/5 px-3 py-1 text-xs font-medium uppercase text-slate-600">
                    {{ identifier.type }} · {{ identifier.value }}
                  </span>
                }
              </dd>
            </div>
          }

          @if (entity.address) {
            <div class="rounded-2xl bg-slate-100/80 p-4 ring-1 ring-slate-200">
              <dt class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{{ 'partner.card.address' | translate }}</dt>
              <dd class="mt-2 space-y-1 text-sm">
                <p>{{ entity.address.line1 }}</p>
                @if (entity.address.line2) {
                  <p>{{ entity.address.line2 }}</p>
                }
                <p>
                  {{ entity.address.city }},
                  {{ ('provinces.' + entity.address.province) | translate }}
                  @if (entity.address.postalCode) {
                    <span>· {{ entity.address.postalCode }}</span>
                  }
                </p>
                @if (countryLabel(entity.address.country); as countryName) {
                  <p>{{ countryName }}</p>
                }
              </dd>
            </div>
          }

          <div class="rounded-2xl bg-slate-100/80 p-4 ring-1 ring-slate-200">
            <dt class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{{ 'partner.card.contacts' | translate }}</dt>
            <dd class="mt-2 space-y-1 text-sm">
              @if (entity.phone) {
                <a class="block text-slate-800 hover:text-emerald-600" [href]="'tel:' + entity.phone">{{ entity.phone }}</a>
              }
              @if (entity.email) {
                <a class="block text-slate-800 hover:text-emerald-600" [href]="'mailto:' + entity.email">{{ entity.email }}</a>
              }
              @if (entity.website) {
                <a class="block text-slate-800 hover:text-emerald-600" [href]="entity.website" target="_blank" rel="noopener">
                  {{ entity.website }}
                </a>
              }
            </dd>
          </div>
        </dl>
      </div>

      <div class="space-y-4">
        <div class="rounded-2xl bg-slate-900 p-4 text-slate-100 shadow-lg ring-1 ring-slate-900/40">
          <h4 class="text-xs font-semibold uppercase tracking-[0.3em] text-emerald-200">
            {{ 'partner.panel.verification.title' | translate }}
          </h4>
          <div class="mt-3 space-y-3 text-xs font-semibold uppercase tracking-[0.25em]">
            <span
              class="inline-flex items-center rounded-full px-3 py-1"
              [ngClass]="verificationStatusClass(verificationStatus())"
            >
              {{ verificationStatusKey() | translate }}
            </span>
            @if (trustScore(); as reliabilityScore) {
              <span class="block text-[0.65rem] text-emerald-200">
                {{ 'partner.panel.verification.trustScore' | translate:{ value: reliabilityScore } }}
              </span>
            } @else {
              <span class="block text-[0.65rem] text-slate-300">
                {{ 'partner.panel.verification.trustScoreUnknown' | translate }}
              </span>
            }
          </div>
          <div class="mt-4 space-y-3 text-sm text-slate-100">
            @if (recentTrustHistory().length) {
              <ul class="space-y-3">
                @for (record of recentTrustHistory(); track record.id ?? record.label) {
                  <li class="rounded-xl bg-slate-900/60 p-3">
                    <div class="flex items-start justify-between gap-3">
                      <div>
                        <p class="text-sm font-semibold text-slate-100">{{ record.label }}</p>
                        <p class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-300">
                          {{ historyTypeKey(record.type) | translate }} · {{ historyDirectionKey(record.direction) | translate }}
                        </p>
                      </div>
                      <span class="text-[0.65rem] uppercase tracking-[0.2em] text-slate-300">
                        {{ formatHistoryDate(record.occurredAt) }}
                      </span>
                    </div>
                    <div class="mt-2 flex flex-wrap gap-3 text-[0.65rem] uppercase tracking-[0.2em] text-slate-300">
                      @if (record.amount != null) {
                        <span>{{ 'partner.panel.verification.historyAmount' | translate:{ value: record.amount } }}</span>
                      }
                      @if (formatHistoryScore(record.score); as entryScore) {
                        <span>{{ 'partner.panel.verification.historyScore' | translate:{ value: entryScore } }}</span>
                      }
                    </div>
                    @if (record.notes) {
                      <p class="mt-2 text-xs leading-relaxed text-slate-200">{{ record.notes }}</p>
                    }
                  </li>
                }
              </ul>
            } @else {
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                {{ 'partner.panel.verification.historyEmpty' | translate }}
              </p>
            }
          </div>
        </div>

        @if (entity.leadership?.length) {
          <div class="rounded-2xl bg-slate-100/80 p-4 ring-1 ring-slate-200">
            <h4 class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{{ 'partner.card.leadership' | translate }}</h4>
            <ul class="mt-3 space-y-3 text-sm">
              @for (leader of entity.leadership; track leader.name) {
                <li>
                  <p class="font-semibold text-slate-900">{{ leader.name }}</p>
                  @if (leader.title) {
                    <p class="text-xs uppercase tracking-wide text-slate-500">{{ leader.title }}</p>
                  }
                  <div class="mt-1 flex flex-wrap gap-3 text-xs text-slate-600">
                    @if (leader.email) {
                      <a class="hover:text-emerald-600" [href]="'mailto:' + leader.email">{{ leader.email }}</a>
                    }
                    @if (leader.phone) {
                      <a class="hover:text-emerald-600" [href]="'tel:' + leader.phone">{{ leader.phone }}</a>
                    }
                  </div>
                </li>
              }
            </ul>
          </div>
        }

        @if (socialLinks(); as socials) {
          <div class="rounded-2xl bg-slate-100/80 p-4 ring-1 ring-slate-200">
            <h4 class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{{ 'partner.card.networks' | translate }}</h4>
            <div class="mt-3 flex flex-wrap gap-3">
              @for (link of socials; track link.url) {
                @let icon = iconFor(link.type);
                <a
                  class="group inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-semibold text-slate-600 transition hover:border-emerald-400 hover:text-emerald-600"
                  [href]="link.url"
                  target="_blank"
                  rel="noopener"
                  [attr.aria-label]="link.label ?? link.type"
                >
                  <svg class="h-4 w-4 text-emerald-500 transition group-hover:text-emerald-600" [attr.viewBox]="icon.viewBox" fill="currentColor">
                    <path [attr.d]="icon.path"></path>
                  </svg>
                  <span>{{ link.label ?? prettyType(link.type) }}</span>
                </a>
              }
            </div>
          </div>
        }
      </div>
    </section>

    <section class="grid gap-4 lg:grid-cols-[minmax(0,3fr)_minmax(0,2fr)]">
      <div class="rounded-3xl bg-slate-100/80 p-6 ring-1 ring-slate-200">
        <h4 class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{{ 'partner.card.mission' | translate }}</h4>
        <p class="mt-3 text-sm text-slate-700">{{ mission() }}</p>
        @if (entity.highlights?.length) {
          <ul class="mt-4 space-y-2 text-sm text-slate-700">
            @for (highlight of entity.highlights; track highlight) {
              <li class="flex items-start gap-2">
                <span class="mt-1 inline-block h-1.5 w-1.5 flex-none rounded-full bg-emerald-500"></span>
                <span>{{ highlight }}</span>
              </li>
            }
          </ul>
        }
      </div>

      <div class="flex flex-col justify-between gap-3 rounded-3xl bg-slate-900 p-6 text-slate-100 shadow-lg">
        <h4 class="text-xs font-semibold uppercase tracking-[0.3em] text-emerald-300">{{ 'partner.card.actions' | translate }}</h4>
        <div class="flex flex-col gap-3">
          <button
            type="button"
            class="inline-flex items-center justify-center gap-2 rounded-full border border-emerald-400/60 bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 transition hover:bg-emerald-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-200"
            (click)="onDownload(entity)"
          >
            {{ 'partner.card.download' | translate }}
          </button>
          <button
            type="button"
            class="inline-flex items-center justify-center gap-2 rounded-full border border-slate-500/70 bg-transparent px-4 py-2 text-sm font-semibold text-slate-100 transition hover:bg-slate-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-200"
            (click)="onShare(entity)"
          >
            {{ 'partner.card.share' | translate }}
          </button>
        </div>
      </div>
    </section>
  } @else {
    <div class="flex h-full min-h-[320px] items-center justify-center rounded-3xl border border-dashed border-slate-300 bg-white/50 p-10 text-center text-sm text-slate-400">
      {{ 'partner.card.placeholder' | translate }}
    </div>
  }
</article>
