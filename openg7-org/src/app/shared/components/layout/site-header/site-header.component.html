<header
  data-og7="site-header"
  class="sticky top-0 z-50 w-full border-b border-white/10 bg-gradient-to-r from-slate-950/85 via-slate-900/70 to-slate-950/85 backdrop-blur"
  role="banner"
>
  <div class="mx-auto flex h-16 max-w-7xl items-center gap-3 px-3 sm:px-4">
    <a routerLink="/" class="flex shrink-0 items-center gap-2 w-[5%]" aria-label="OpenG7">
      <img src="/assets/dragon-transparent-clean.png" alt="OpenG7" class="" />
      <span class="hidden text-sm font-semibold tracking-wide text-white/90 sm:inline">OpenG7</span>
    </a>

    <div class="mx-auto hidden max-w-xl flex-1 sm:flex">
      <div class="relative w-full">
        <span id="desktop-search-label" class="sr-only">{{ 'header.search.aria' | translate }}</span>
        <button
          id="desktop-search"
          type="button"
          data-og7="search-box"
          data-og7-id="spotlight-trigger"
          class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-left text-sm text-white/70 outline-none transition focus:border-cyan-400/40 focus:ring-2 focus:ring-cyan-400/30"
          (click)="toggleSearch(true)"
          aria-haspopup="dialog"
          [attr.aria-expanded]="isSearchOpen()"
          aria-controls="quick-search-modal"
          aria-labelledby="desktop-search-label"
          aria-describedby="desktop-search-hint"
        >
          {{ 'header.search.placeholder' | translate }}
        </button>
        <kbd
          id="desktop-search-hint"
          class="pointer-events-none absolute right-2 top-1/2 hidden -translate-y-1/2 rounded-md border border-white/20 px-2 py-0.5 text-[10px] font-medium text-white/60 sm:block"
        >
          CTRL K
        </kbd>
      </div>
    </div>

    <nav class="ml-auto hidden items-center gap-1 sm:flex" [attr.aria-label]="'header.nav.ariaLabel' | translate">
      <a
        routerLink="/credits"
        class="rounded-lg p-2 text-white transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/40"
        [attr.aria-label]="'header.nav.credits' | translate"
      >
        <svg viewBox="0 0 24 24" class="h-5 w-5 text-white" fill="currentColor" aria-hidden="true">
          <path
            d="M12 2a5 5 0 0 0-5 5c0 2.315 1.572 4.262 3.71 4.86L9 22l3-1 3 1-1.71-10.14C15.428 11.262 17 9.315 17 7a5 5 0 0 0-5-5zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"
          ></path>
          <path d="m9.52 12.62-1.03 6.07L12 17.5l3.51 1.19-1.03-6.07A5.99 5.99 0 0 1 12 13.5a5.99 5.99 0 0 1-2.48-.88z"></path>
        </svg>
      </a>

      <button
        type="button"
        data-og7="notif"
        (click)="toggleNotif()"
        class="relative rounded-lg p-2 text-white/70 transition hover:bg-white/10 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/40"
        [ngClass]="{ 'ring-1 ring-cyan-400/30 bg-white/5 text-white': hasUnread() }"
        aria-haspopup="true"
        [attr.aria-expanded]="isNotifOpen()"
        [attr.aria-label]="'header.notifications.title' | translate"
      >
        <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
          <path d="M12 2a6 6 0 0 0-6 6v3.586l-.707.707A1 1 0 0 0 6 14h12a1 1 0 0 0 .707-1.707L18 11.586V8a6 6 0 0 0-6-6z"></path>
          <path d="M9 18a3 3 0 0 0 6 0H9z"></path>
        </svg>
        <span
          *ngIf="hasUnread()"
          class="absolute -right-0.5 -top-0.5 inline-flex h-4 min-w-4 items-center justify-center rounded-full bg-cyan-400 px-1 text-[10px] font-bold text-slate-950"
        >
          {{ unreadCount() }}
        </span>
      </button>

      <div class="relative" data-og7="lang">
        <button
          type="button"
          (click)="toggleLang()"
          class="flex items-center gap-2 rounded-lg px-2 py-2 text-sm text-white/80 transition hover:bg-white/10 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/40"
          aria-haspopup="listbox"
          [attr.aria-expanded]="isLangOpen()"
        >
          <span class="font-semibold uppercase">{{ currentLang() }}</span>
          <svg viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4" aria-hidden="true">
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </button>
        <ul
          *ngIf="isLangOpen()"
          class="absolute right-0 mt-2 w-28 overflow-hidden rounded-xl border border-white/10 bg-slate-800/95 p-1 shadow-xl backdrop-blur"
          role="listbox"
        >
          <li *ngFor="let lang of languages">
            <button
              type="button"
              (click)="setLang(lang)"
              class="w-full rounded-lg px-3 py-2 text-left text-sm text-white/80 hover:bg-white/10 hover:text-white"
              role="option"
              [attr.aria-selected]="currentLang() === lang"
            >
              {{ ('header.lang.' + lang) | translate }}
            </button>
          </li>
        </ul>
      </div>

      <div class="relative" data-og7="more">
        <button
          type="button"
          (click)="toggleMore()"
          class="rounded-lg p-2 text-white/70 transition hover:bg-white/10 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/40"
          aria-haspopup="true"
          [attr.aria-expanded]="isMoreOpen()"
          [attr.aria-label]="'header.more.open' | translate"
        >
          <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
            <circle cx="5" cy="12" r="2"></circle>
            <circle cx="12" cy="12" r="2"></circle>
            <circle cx="19" cy="12" r="2"></circle>
          </svg>
        </button>
        <div
          *ngIf="isMoreOpen()"
          class="absolute right-0 mt-2 w-56 overflow-hidden rounded-xl border border-white/10 bg-slate-800/95 p-1 shadow-xl backdrop-blur"
        >
          <a
            routerLink="/register"
            (click)="toggleMore()"
            class="block rounded-lg px-3 py-2 text-sm text-slate-100 hover:bg-white/10 hover:text-white"
          >
            {{ 'header.more.registration' | translate }}
          </a>
          <a
            routerLink="/importation"
            (click)="toggleMore()"
            class="block rounded-lg px-3 py-2 text-sm text-slate-100 hover:bg-white/10 hover:text-white"
          >
            {{ 'header.more.importation' | translate }}
          </a>
          <a
            routerLink="/statistics"
            (click)="toggleMore()"
            class="block rounded-lg px-3 py-2 text-sm text-slate-100 hover:bg-white/10 hover:text-white"
          >
            {{ 'header.more.stats' | translate }}
          </a>
          <a
            routerLink="/pricing"
            (click)="toggleMore()"
            class="block rounded-lg px-3 py-2 text-sm text-slate-100 hover:bg-white/10 hover:text-white"
          >
            {{ 'header.more.pricing' | translate }}
          </a>

          <div class="my-1 h-px bg-white/10"></div>

          <a
            href="https://discord.gg/openg7"
            target="_blank"
            rel="noopener"
            (click)="toggleMore()"
            class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-slate-100 hover:bg-white/10 hover:text-white"
          >
            <span class="text-white/70">ðŸ’¬</span>
            <span>{{ 'header.more.discord' | translate }}</span>
          </a>

          <a
            href="https://github.com/OpenG7"
            target="_blank"
            rel="noopener"
            (click)="toggleMore()"
            class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-slate-100 hover:bg-white/10 hover:text-white"
          >
            <span class="text-white/70">âŒ˜</span>
            <span>{{ 'header.more.github' | translate }}</span>
          </a>

          <a
            routerLink="/docs"
            (click)="toggleMore()"
            class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-slate-100 hover:bg-white/10 hover:text-white"
          >
            <span class="text-white/70">ðŸ“˜</span>
            <span>{{ 'header.more.docs' | translate }}</span>
          </a>
        </div>
      </div>

      <ng-container *ngIf="isAuthSig(); else guestDesktop">
        <div class="relative" data-og7="profile">
          <button
            type="button"
            (click)="toggleProfile()"
            class="flex items-center gap-2 rounded-full px-2 py-1.5 text-sm text-white transition hover:bg-white/10 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/40"
            aria-haspopup="true"
            [attr.aria-expanded]="isProfileOpen()"
            [attr.aria-label]="'header.profile.menuLabel' | translate"
          >
            <span class="flex h-8 w-8 items-center justify-center overflow-hidden rounded-full bg-white/10">
              <img *ngIf="avatarUrlSig(); else initials" [src]="avatarUrlSig()!" alt="" class="h-full w-full object-cover" />
              <ng-template #initials>
                <span class="text-xs font-semibold uppercase text-white">{{ initialsSig() }}</span>
              </ng-template>
            </span>
            <span class="hidden max-w-[140px] truncate text-left text-xs font-medium text-white lg:block">
              {{ displayNameSig() }}
            </span>
          </button>
          <ul
            *ngIf="isProfileOpen()"
            class="absolute right-0 mt-2 w-56 overflow-hidden rounded-xl border border-white/10 bg-slate-800/95 p-1 shadow-xl backdrop-blur"
          >
            <li>
              <a
                routerLink="/favorites"
                (click)="toggleProfile()"
                class="flex items-center justify-between rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
              >
                <span>{{ 'header.profile.matches' | translate }}</span>
                <span *ngIf="matchesCountSig() > 0" class="rounded-full bg-cyan-400 px-2 py-0.5 text-xs font-semibold text-slate-950">
                  {{ matchesCountSig() }}
                </span>
              </a>
            </li>
            <li>
              <a
                routerLink="/saved-searches"
                (click)="toggleProfile()"
                class="block rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
                data-og7-id="saved-searches"
              >
                {{ 'header.profile.savedSearches' | translate }}
              </a>
            </li>
            <li>
              <a
                routerLink="/profile"
                (click)="toggleProfile()"
                class="block rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
              >
                {{ 'header.profile.account' | translate }}
              </a>
            </li>
            <li>
              <button
                type="button"
                (click)="logout()"
                class="w-full rounded-lg px-3 py-2 text-left text-sm text-white hover:bg-white/10 hover:text-white"
              >
                {{ 'header.profile.logout' | translate }}
              </button>
            </li>
          </ul>
        </div>
      </ng-container>
      <ng-template #guestDesktop>
        <a
          routerLink="/login"
          class="ml-1 rounded-xl bg-cyan-400/90 px-3 py-2 text-sm font-semibold text-slate-950 transition hover:bg-cyan-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/40"
          data-auth-modal-tab="sign-in"
        >
          {{ loginLabelKey() | translate }}
        </a>
      </ng-template>
    </nav>

    <button
      type="button"
      (click)="toggleMobileMenu()"
      class="ml-auto inline-flex items-center rounded-lg p-2 text-white/80 transition hover:bg-white/10 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/40 sm:hidden"
      [attr.aria-expanded]="isMobileMenuOpen()"
      [attr.aria-label]="'header.mobile.menuLabel' | translate"
    >
      <svg
        viewBox="0 0 24 24"
        class="h-6 w-6"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <path d="M4 7h16M4 12h16M4 17h16"></path>
      </svg>
    </button>
  </div>

  <div *ngIf="isMobileMenuOpen()" class="border-t border-white/10 bg-slate-950/95 px-3 py-3 backdrop-blur sm:hidden">
    <span id="mobile-search-label" class="sr-only">{{ 'header.search.aria' | translate }}</span>
    <button
      id="mobile-search"
      type="button"
      data-og7="search-box"
      data-og7-id="spotlight-trigger"
      class="mb-3 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-left text-sm text-white/70 outline-none focus:border-cyan-400/40 focus:ring-2 focus:ring-cyan-400/30"
      (click)="toggleSearch(true)"
      aria-haspopup="dialog"
      [attr.aria-expanded]="isSearchOpen()"
      aria-controls="quick-search-modal"
      aria-labelledby="mobile-search-label"
    >
      {{ 'header.search.placeholder' | translate }}
    </button>

    <div class="flex flex-wrap items-center gap-2">
      <a
        routerLink="/credits"
        (click)="closeMobileMenu()"
        class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
      >
        {{ 'header.nav.credits' | translate }}
      </a>
      <a
        routerLink="/importation"
        (click)="closeMobileMenu()"
        class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
      >
        {{ 'header.more.importation' | translate }}
      </a>
      <a
        href="https://discord.gg/openg7"
        target="_blank"
        rel="noopener"
        class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
      >
        Discord
      </a>
      <a
        href="https://github.com/OpenG7"
        target="_blank"
        rel="noopener"
        class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
      >
        GitHub
      </a>
      <button
        type="button"
        (click)="toggleNotif()"
        class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
      >
        {{ 'header.notifications.title' | translate }}
        <span *ngIf="hasUnread()" class="ml-2 rounded-full bg-cyan-400 px-2 py-0.5 text-xs font-semibold text-slate-950">
          {{ unreadCount() }}
        </span>
      </button>
      <div class="flex gap-1">
        <button
          *ngFor="let lang of languages"
          type="button"
          (click)="setLang(lang)"
          class="rounded-lg px-3 py-2 text-sm font-semibold uppercase text-white/70 hover:bg-white/10 hover:text-white"
          [ngClass]="{ 'bg-white/15': currentLang() === lang }"
        >
          {{ lang }}
        </button>
      </div>
      <ng-container *ngIf="isAuthSig(); else mobileGuest">
        <a
          routerLink="/favorites"
          (click)="closeMobileMenu()"
          class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
        >
          {{ 'header.profile.matches' | translate }}
        </a>
        <a
          routerLink="/saved-searches"
          (click)="closeMobileMenu()"
          class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
          data-og7-id="saved-searches"
        >
          {{ 'header.profile.savedSearches' | translate }}
        </a>
        <a
          routerLink="/profile"
          (click)="closeMobileMenu()"
          class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
        >
          {{ 'header.profile.account' | translate }}
        </a>
        <button
          type="button"
          (click)="logout()"
          class="rounded-lg px-3 py-2 text-sm text-white hover:bg-white/10 hover:text-white"
        >
          {{ 'header.profile.logout' | translate }}
        </button>
      </ng-container>
      <ng-template #mobileGuest>
        <a
          routerLink="/login"
          (click)="closeMobileMenu()"
          class="rounded-xl bg-cyan-400/90 px-3 py-2 text-sm font-semibold text-slate-950 hover:bg-cyan-300"
          data-auth-modal-tab="sign-in"
        >
          {{ loginLabelKey() | translate }}
        </a>
      </ng-template>
    </div>
  </div>

  <div
    *ngIf="isNotifOpen()"
    class="absolute right-4 top-16 hidden w-80 overflow-hidden rounded-xl border border-white/10 bg-slate-800/95 p-3 shadow-2xl backdrop-blur sm:block"
    data-og7="notif"
  >
    <p class="mb-2 text-sm font-semibold text-white/90">{{ 'header.notifications.title' | translate }}</p>
    <p *ngIf="!notificationEntries().length" class="text-sm text-white/60">
      {{ 'header.notifications.empty' | translate }}
    </p>
    <ul *ngIf="notificationEntries().length" class="space-y-1 text-sm text-white/80">
      <li
        *ngFor="let notification of notificationEntries(); trackBy: trackNotification"
        class="rounded-lg bg-white/5 p-2"
      >
        <span class="block font-medium text-white/90">{{ notification.title ?? notification.message }}</span>
        <span class="block text-xs text-white/60" *ngIf="notification.title">{{ notification.message }}</span>
      </li>
    </ul>
  </div>

</header>
