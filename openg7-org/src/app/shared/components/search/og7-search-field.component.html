<div class="relative w-full" data-og7="search-box">
  <button
    #triggerButton
    type="button"
    (click)="openPalette()"
    class="flex w-full items-center mt-1 rounded-full border border-white/10
           bg-slate-900/80 py-2 text-left text-sm font-medium text-slate-200
           shadow-[0_0_0_1px_rgba(255,255,255,0.04)] transition
           hover:border-white/30 hover:bg-slate-900 focus-visible:outline
           focus-visible:outline-2 focus-visible:outline-offset-2
           focus-visible:outline-cyan-400 disabled:cursor-not-allowed
           disabled:opacity-60 og7-search__trigger"
    [attr.aria-expanded]="paletteOpen()"
    [attr.aria-label]="ariaLabel || 'Ouvrir la recherche'"
    [disabled]="disabled"
    style="height: 25px;
    padding-left: 6px;"
  >
    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" class="text-slate-400 og7-search__icon">
      <path fill="currentColor"
            d="M15.5 14h-.79l-.28-.27A6.5 6.5 0 1 0 9.5 16c1.6 0 3.08-.59 4.22-1.57l.27.28v.79l5 5L20.5 19l-5-5zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14z"/>
    </svg>
    <span class="px-2 py-0.5
                 text-[11px] font-semibold uppercase tracking-wider text-slate-300 og7-search__shortcut">
      Ctrl K
    </span>
  </button>

  <div *ngIf="!quickSearchTrigger && paletteOpen()" class="fixed inset-0 z-[60] flex items-start justify-center px-4 py-24">
    <div class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm" aria-hidden="true"></div>

    <div
      #panel
      class="relative w-full max-w-3xl overflow-hidden rounded-3xl border border-white/10
                bg-slate-900/95 text-slate-100 shadow-2xl ring-1 ring-white/10">
      <form
        (submit)="$event.preventDefault(); commit('enter'); closePalette();"
        class="border-b border-white/5 bg-slate-900/60 px-6 pb-5 pt-6"
      >
        <div class="relative flex items-center gap-3 rounded-2xl border border-white/10
                    bg-slate-900/60 px-4 py-3 text-sm text-slate-100 shadow-inner
                    focus-within:border-cyan-400/80 focus-within:ring-1 focus-within:ring-cyan-400/40">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" class="text-slate-400">
            <path fill="currentColor"
                  d="M15.5 14h-.79l-.28-.27A6.5 6.5 0 1 0 9.5 16c1.6 0 3.08-.59 4.22-1.57l.27.28v.79l5 5L20.5 19l-5-5zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14z"/>
          </svg>
          <input
            #input
            type="search"
            [value]="value"
            (input)="onInput($any($event.target).value ?? '')"
            (focus)="onFocus()"
            (blur)="onBlur()"
            (keydown.enter)="commit('enter')"
            (keydown.escape)="onEscape()"
            [placeholder]="placeholder || 'Recherche rapide'"
            [attr.aria-label]="ariaLabel || placeholder || 'Recherche'"
            role="searchbox"
            [disabled]="disabled"
            class="flex-1 bg-transparent text-base text-slate-100 placeholder:text-slate-400 focus:outline-none"
          />
          <span class="hidden rounded-md border border-white/10 bg-slate-800/60 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wider text-slate-300 sm:block">
            Ctrl K
          </span>

          <button
            *ngIf="showClear()"
            type="button"
            (click)="clear()"
            class="rounded-full p-1.5 text-slate-400 transition hover:bg-slate-800 hover:text-slate-200"
            aria-label="Effacer"
          >
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path fill="currentColor"
                    d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7a1 1 0 1 0-1.41 1.41L10.59 12l-4.9 4.89a1 1 0 1 0 1.41 1.41L12 13.41l4.89 4.9a1 1 0 0 0 1.41-1.41L13.41 12l4.9-4.89a1 1 0 0 0-.01-1.4Z"/>
            </svg>
          </button>

          <div *ngIf="loading" class="flex h-5 w-5 items-center justify-center">
            <svg class="h-4 w-4 animate-spin text-cyan-300" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="3" fill="none" class="opacity-20"/>
              <path d="M21 12a9 9 0 0 0-9-9" stroke="currentColor" stroke-width="3" fill="none"/>
            </svg>
          </div>
        </div>
      </form>

      <div class="grid gap-8 px-6 py-6 md:grid-cols-[1.4fr,1fr]">
        <div class="space-y-6">
          <section *ngFor="let section of primarySections" class="space-y-3">
            <div class="text-xs font-semibold uppercase tracking-widest text-slate-400">{{ section.title }}</div>
            <div class="space-y-2">
              <button
                *ngFor="let item of section.items"
                type="button"
                class="block w-full rounded-2xl border border-white/5 bg-slate-900/40 p-4 text-left transition hover:border-cyan-400/60 hover:bg-slate-800/60"
                (click)="selectSuggestion(item.label)"
              >
                <div class="flex items-start justify-between gap-4">
                  <div>
                    <div class="text-sm font-semibold text-slate-100">{{ item.label }}</div>
                    <div *ngIf="item.description" class="mt-1 text-xs text-slate-400">{{ item.description }}</div>
                  </div>
                  <span *ngIf="item.badge" class="rounded-full px-3 py-1 text-xs font-medium"
                        [ngClass]="item.badgeClass">
                    {{ item.badge }}
                  </span>
                </div>
              </button>
            </div>
          </section>
        </div>

        <div class="space-y-6">
          <section *ngFor="let section of secondarySections" class="space-y-3">
            <div class="text-xs font-semibold uppercase tracking-widest text-slate-400">{{ section.title }}</div>
            <div class="space-y-2">
              <button
                *ngFor="let item of section.items"
                type="button"
                class="flex w-full items-center justify-between gap-3 rounded-2xl border border-white/5 bg-slate-900/40 px-4 py-3 text-left text-sm transition hover:border-cyan-400/60 hover:bg-slate-800/60"
                (click)="selectSuggestion(item.label)"
              >
                <span class="text-slate-200">{{ item.label }}</span>
                <span *ngIf="item.badge" class="rounded-full px-2 py-0.5 text-[11px] font-medium"
                      [ngClass]="item.badgeClass">
                  {{ item.badge }}
                </span>
              </button>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
</div>
