**Languages:** [English](#english) | [Français](#francais)

<a id="english"></a>
# OpenG7 Monorepo Architecture

This document summarizes the technical organization of the `openg7-plateform` repository: Yarn workspaces, functional responsibilities, build flows, and dependencies between the Angular front-end, the Strapi CMS, and shared packages.

## Workspaces and Responsibilities

- **Front (@openg7/web)**: Angular 19 standalone/SSR application hosted in `openg7-org`, with runtime configuration generation and integration of MapLibre, NgRx Signals, and i18n via `@ngx-translate`. The `start`, `build`, and `build:preprod` scripts orchestrate the Express SSR server and the runtime configuration generation on the Node side. 【F:openg7-org/package.json†L1-L41】  
- **CMS (@openg7/strapi)**: Strapi v5 workspace (`strapi`) responsible for content, idempotent seeds, and admin configuration (Postgres/Redis/S3). The seed is invoked automatically in development and can be re-run via `yarn seed:dev`, with environment guards for secrets and initial admin. 【F:strapi/README.md†L8-L41】【F:strapi/README.md†L66-L87】  
- **API Contracts (packages/contracts)**: workspace used by the front-end and Strapi to share schemas and generated clients based on CMS endpoints. The root scripts `yarn codegen` and `yarn test` rely on this workspace before any front-end build. 【F:package.json†L1-L38】  
- **Tooling (@openg7/tooling)**: cross-cutting utilities (e.g. validation of `[data-og7]` selectors) exposed via a `validate-selectors` binary and a `validate:selectors` script. 【F:packages/tooling/package.json†L1-L15】  

## Local Development and CI Flows

- **Full-stack loop**: `yarn dev:cms` starts Strapi in develop mode, `yarn dev:web` runs the Angular UI (HMR), and `yarn dev:all` orchestrates both via `concurrently`. 【F:package.json†L9-L24】  
- **Front prebuild**: `yarn prebuild:web` runs `yarn codegen && yarn test` to guarantee that API contracts are up to date before the Angular compilation. The preprod validation adds checks for selectors and runtime configuration files. 【F:package.json†L19-L32】  
- **Quality and formatting**: `yarn lint` applies the monorepo ESLint configuration, while `yarn format:check` validates Prettier formatting to avoid non-functional diffs. 【F:package.json†L33-L41】  

## Component Interactions

- **Front ↔️ CMS**: the Angular application consumes Strapi endpoints via clients generated by `@openg7/contracts` and exposes SSR pages (Express server) to align i18n data and server-side pre-rendering. 【F:openg7-org/package.json†L4-L18】【F:openg7-org/package.json†L42-L82】  
- **CMS ↔️ storage/infra**: Strapi targets Postgres for data, S3 for media, and Redis for sessions/rate limiting; environment variables control the seed mode to prevent any automatic bootstrap in production. 【F:strapi/README.md†L43-L87】  

## Directory Structure (Overview)

```text
/ (monorepo root)
├─ openg7-org/               # Angular SSR front-end (@openg7/web)
├─ strapi/                   # Strapi v5 CMS (@openg7/strapi)
├─ packages/
│  ├─ contracts/             # Shared API schemas and codegen
│  └─ tooling/               # Validation scripts (e.g. selectors)
├─ infra/                    # Infra manifests and assets (k8s, CI)
└─ docs/                     # Onboarding, front-end and Strapi guides

For a guided discovery, the Mermaid diagram in the onboarding guide visually shows the three workspaces and their reference team. 【F:docs/getting-started.md†L59-L80】

<a id="francais"></a>

Architecture du monorepo OpenG7

Ce document résume l'organisation technique du dépôt openg7-plateform : workspaces Yarn, responsabilités fonctionnelles, flux de build et dépendances entre le front Angular, le CMS Strapi et les packages partagés.

Workspaces et responsabilités

Front (@openg7/web) : application Angular 19 standalone/SSR hébergée dans openg7-org, avec génération de configuration runtime et intégration MapLibre, NgRx Signals et i18n via @ngx-translate. Les scripts start, build et build:preprod orchestrent le serveur Express SSR et la génération de configuration côté Node. 【F:openg7-org/package.json†L1-L41】

CMS (@openg7/strapi) : workspace Strapi v5 (strapi) responsable des contenus, seeds idempotents et configuration admin (Postgres/Redis/S3). Le seed est appelé automatiquement en développement et peut être relancé via yarn seed:dev, avec des gardes d'environnement pour les secrets et l'admin initial. 【F:strapi/README.md†L8-L41】【F:strapi/README.md†L66-L87】

Contrats API (packages/contracts) : workspace utilisé par le front et Strapi pour partager les schémas et clients générés à partir des endpoints CMS. Les scripts racine yarn codegen et yarn test se basent sur cette cible avant tout build front. 【F:package.json†L1-L38】

Tooling (@openg7/tooling) : utilitaires transverses (ex. validation des sélecteurs [data-og7]) exposés via un binaire validate-selectors et un script validate:selectors. 【F:packages/tooling/package.json†L1-L15】

Flux de développement et CI locaux

Boucle full-stack : yarn dev:cms démarre Strapi en mode develop, yarn dev:web lance l'UI Angular (HMR), et yarn dev:all orchestre les deux via concurrently. 【F:package.json†L9-L24】

Prébuild front : yarn prebuild:web exécute yarn codegen && yarn test pour garantir que les contrats API sont à jour avant la compilation Angular. La validation préprod ajoute la vérification des sélecteurs et des fichiers de configuration runtime. 【F:package.json†L19-L32】

Qualité et formatage : yarn lint applique la configuration ESLint monorepo, tandis que yarn format:check valide le formatage Prettier pour éviter des diffs non fonctionnels. 【F:package.json†L33-L41】

Interactions entre composants

Front ↔️ CMS : l'application Angular consomme les endpoints Strapi via les clients générés par @openg7/contracts et expose des pages SSR (serveur Express) pour aligner les données i18n et le pré-rendu côté serveur. 【F:openg7-org/package.json†L4-L18】【F:openg7-org/package.json†L42-L82】

CMS ↔️ stockage/infra : Strapi cible Postgres pour les données, S3 pour les médias et Redis pour sessions/ratelimiting ; les variables d'environnement contrôlent le mode seed pour éviter tout bootstrap automatique en production. 【F:strapi/README.md†L43-L87】

Structure répertoire (vue synthétique)
/ (racine monorepo)
├─ openg7-org/               # Front Angular SSR (@openg7/web)
├─ strapi/                   # CMS Strapi v5 (@openg7/strapi)
├─ packages/
│  ├─ contracts/             # Schémas API et codegen partagés
│  └─ tooling/               # Scripts de validation (ex. selectors)
├─ infra/                    # Manifests et assets d'infra (k8s, CI)
└─ docs/                     # Guides d'onboarding, front et Strapi


Pour une découverte guidée, le diagramme Mermaid du guide d'onboarding présente visuellement les trois workspaces et leur équipe référente. 【F:docs/getting-started.md†L59-L80】